name: Workflow dispatch

on: [workflow_dispatch]

jobs:
  checks:
    runs-on: ubuntu-latest

    steps:

    - name: Deploy container
      uses: appleboy/ssh-action@master
      with:
        host: ${{secrets.DEPLOY_IP}}
        username: ubuntu
        key: ${{secrets.DEPLOY_SSH_KEY}}
        script: |
          git clone https://github.com/viktal/telegram_search_bot.git
          cd telegram_search_bot

          docker build -t pybot:latest .
          docker stop $(docker ps -aq)
          docker run pybot:latest & disown
          docker system prune -f
